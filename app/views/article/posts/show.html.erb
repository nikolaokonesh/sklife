<% keywords truncate(strip_tags(@post.body_post.body.to_s), length: 100, omission: '').split.uniq.sort %>
<% description truncate(strip_tags(@post.body_post.body.to_s), length: 200) %>
<% content_for :canonical_link, category_post_url(@post.posttable, @post, subdomain: false) %>

<% content_for :titleise do %>
  <div class="flex flex-wrap">
    <div class="w-full max-w-3xl mx-auto">
      <%= link_to icon('fas', 'chevron-left', sanitize(strip_tags(@post.posttable.title))), url_for(@post.posttable), class: 'text-gray-500 hover:text-gray-600' %>
      <div class="block text-2xl"><%= title sanitize(strip_tags(@post.title)) %></div>
      <div class="block text-sm">
        <%= link_to icon('fas', 'pen'), edit_category_post_path(@post.posttable, @post), title: "Редактировать", class: 'text-blue-500 mx-2' if @post.user == current_user %>
        <%= link_to icon('fas', 'trash'), [@post.posttable, @post], method: :delete, data: { confirm: 'Вы уверены?' }, class: 'text-red-600', title: "Удалить", remote: true if @post.user == current_user %>
      </div>
    </div>
  </div>
<% end %>

<div class="w-full">
  <div class="block justify-center">
    <div class="p-2">
      <% if @post.subscribe.present? %>
        <% if current_user_subscribed? %>
          <%= @post.body_post if @post.body_post.present? %>
        <% else %>
          <%= render 'tarif', full: true %>
        <% end %>
      <% else %>
        <%= @post.body_post if @post.body_post.present? %>
      <% end %>
    </div>

    <% @post.youtubes.all.each do |tube| %>
      <div class="py-2">
        <iframe id="ytplayer" type="text/html" width="100%" height="280" class="bg-gray-200" src="https://www.youtube.com/embed/<%= tube.uid %>" frameborder="0" allowfullscreen></iframe>
      </div>
    <% end %>

    <div class="block my-4 px-2">
      <div class="float-right inline-block text-sm text-gray-600">
        Опубликовано <%= time_tag(@post.created_at, :format=>'%d %B %Y в %H:%M') %>
      </div>
      <div class="inline-block">
        <%#= link_to icon('fas', 'chevron-left fa-2x'), url_for(@post.posttable), class: 'text-gray-dark hover:text-gray-darker' %>
      </div>
    </div>
  </div>
</div>

<div class="mb-12 block">
  <% if @posts.present? %>
    <div id="category-post-show-<%= @post.posttable.id %>" data-turbolinks-permanent>
      <div class="w-full" id="categories-show-columns">
        <%= render partial: 'post_small', collection: @posts, cached: true %>
      </div>
      <div class="block pagination mb-4" id="categories-show-paginator">
        <%= pag_helper(@posts, 'Далее') %>
      </div>
    </div>
  <% end %>
</div>

<% if @post.no_comments.present? %>
  <div class="pt-2 mb-4 flex justify-center">
    <div class="w-full mt-4">
      <% unless params[:comment] %>
        <div id="commentos_back">
          <% if @post.subscribe? %>
            <% if current_user_subscribed? %>
              <%= render partial: "comments/form", locals: { commentable: @post, postas: 'postas_post' } %>
            <% else %>
              <div class="text-gray-700 px-2">
                Оставить комментарий может только подписчик
              </div>
            <% end %>
          <% else %>
            <%= render partial: "comments/form", locals: { commentable: @post, postas: 'postas_post' } %>
          <% end %>
        </div>
      <% end %>
      <div class="px-1" id="comments">
        <% if params[:comment] %>
          <h5 class="pt-4"><%= link_to "← Смотреть все комментарии", url_for(anchor: 'commentos_back'), class: 'link' %></h5>
          <%= render partial: 'comments/comment', collection: @comments_parent, locals: {full: true}, continue_thread: 10  %>
        <% end %>
        <div class="d-block" id="comments-show-columns">
          <div id="open_comments" class="mt-4">
            <div data-controller="comments">
              <%= icon('fas', 'spinner fa-pulse', 'Загрузка комментариев') %>
              <%= link_to url_for(open: 'true'), class: 'hidden', remote: true, data: {target: "comments.opencomment"} do %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <br />
      <div class="block pagination mb-4 hidden" id="comments-show-paginator">
        <%= pag_helper(@comments, 'Еще комментарии', :pagina) %>
      </div>
    </div>
  </div>
<% end %>
