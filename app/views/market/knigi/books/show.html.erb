<% keywords truncate(strip_tags(@book.body.body.to_s), length: 100, omission: '').split.uniq.sort %>
<% description truncate(strip_tags(@book.body.body.to_s), length: 200) %>
<% content_for :canonical_link, book_url(@book, subdomain: false) %>

<% content_for :titleise do %>
  <h1 class="t-c">
    <span class="d-inline-block"><%= title sanitize(strip_tags(@book.title)) %></span>
    <small class="h6">
      <%= link_to icon('fas', 'pen'), edit_book_path(@book), data: { toggle: "tooltip", placement: "bottom" }, title: "Редактировать", class: 'link mx-4' if @book.user == current_user %>
      <%= link_to icon('fas', 'trash'), @book, method: :delete, class: 'link--destroy', data: { toggle: "tooltip", placement: "right", confirm: 'Вы уверены?' }, title: "Удалить", remote: true if @book.user == current_user %>
    </small>
  </h1>
<% end %>

<div class="flex md:flex-row flex-wrap">
  <div class="w-full md:w-1/2">
    <div class="w-full max-w-md">
        <%= @book.body %>
        <div class="flex items-center">
          <div class="block w-full lg:inline-block lg:p-3 text-grey-dark no-underline text-sm">
            Автор: <%= sanitize(strip_tags(@book.author)) %>
            <br/>
            Книга <%= time_tag(@book.data, :format=>'%Y года') %>
          </div>
        </div>

        <div class="block mt-5">
          <%= link_to icon('fas', 'chevron-left fa-2x'), books_path, class: 'link text-sm' %>
        </div>

    </div>
  </div>
  <div class="w-full md:w-1/2">
    <div class="justify-center">
      <% if user_signed_in? %>
        <% unless user_added_to_library?(current_user, @book) %>
          <%= render 'book-controls', book: @book %>
        <% end %>
      <% else %>
        <%= render 'book-controls', book: @book %>
      <% end %>

      <div class="w-full bg-white shadow-md rounded pb-4">
        <%= content_tag :div, 'Содержание', class: 'p-1 pl-4 border-b rounded-t bg-grey-dark text-grey-lightest' %>
        <div class="rounded-b my-4">
          <div class="px-1" id="comments">
            <%= render partial: 'market/knigi/books/pages/page', collection: @pages %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% if @book.user == current_user %>
  <%= render partial: "market/knigi/books/pages/form", locals: { commentable: @book } %>
<% end %>
